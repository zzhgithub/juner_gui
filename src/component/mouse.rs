use crate::gui::DisplayUi;
use crate::helper::image_by_text;
use alloc::vec::*;
use embedded_graphics::{drawable::Pixel, pixelcolor::Rgb888, prelude::Point};
use hashbrown::HashMap;

pub struct Mouse {
    // pub height: u32,
    // pub width: u32,
    pub level: usize,
    pub position: (u32, u32),
    // pub color: Rgb888,
    // pub locked: bool,
}

// 鼠标有一个图像

// 要可以移动？？

// 也就是说 可以被手动的调用一个方法去移动？？
// 还是 一个方法来更新它的位置？

// 是不是要引入到 事件机制

impl Mouse {
    pub fn new(level: usize, position: (u32, u32)) -> Self {
        Mouse { level, position }
    }
    // 生成一个默认的鼠标指针
    pub fn default() -> Self {
        Mouse::new(10, (0, 0))
    }
}

impl DisplayUi for Mouse {
    fn level(&mut self, level: usize) {
        self.level = level
    }

    fn position(&mut self, position: (u32, u32)) {
        self.position = position
    }

    fn resize(&mut self, height: u32, width: u32) {
        unimplemented!()
    }

    fn draw(&mut self) {
        unimplemented!()
    }

    fn flush(&mut self) {
        let mut color_map = HashMap::new();
        color_map.insert('#', Rgb888::new(255, 255, 255));
        color_map.insert(';', Rgb888::new(255, 255, 255));
        color_map.insert('%', Rgb888::new(255, 255, 255));
        color_map.insert('.', Rgb888::new(255, 255, 255));
        color_map.insert('|', Rgb888::new(255, 255, 255));
        color_map.insert('$', Rgb888::new(255, 255, 255));
        color_map.insert('!', Rgb888::new(255, 255, 255));
        color_map.insert('@', Rgb888::new(255, 255, 255));
        color_map.insert(':', Rgb888::new(255, 255, 255));
        color_map.insert('&', Rgb888::new(255, 255, 255));
        color_map.insert('o', Rgb888::new(255, 255, 255));
        // color_map.insert("%", Rgb888::new(255, 255, 255));
        // color_map.insert("%", Rgb888::new(255, 255, 255));
        let image = image_by_text(
            &[
                ";######%.                                                                                                                      ",
                ";######|                                                                                                                  ",
                ";######|                                                                                                                         ",
                ";######%.....                                                                                                                   ",
                ";#############|                                                                                                                  ",
                ";#############|                                                                                                                  ",
                ";#############|                                                                                                                  ",
                ";######|      !######!                                                                                                           ",
                ";######|      ;######!                                                                                                           ",
                ";######|      ;######!                                                                                                           ",
                ";######|             !######!                                                                                                    ",
                ";######|             !######!                                                                                                    ",
                ";######|             !######!                                                                                                    ",
                ";######|                    !######;                                                                                             ",
                ";######|                    !######;                                                                                             ",
                ";######|                    !######;                                                                                             ",
                ";######|                    :$$$$$$!.                                                                                            ",
                ";######|                           |######;                                                                                      ",
                ";######|                           |######;                                                                                      ",
                ";######|                           |######;                                                                                      ",
                ";######|                                  |######;                                                                               ",
                ";######|                                  |######;                                                                               ",
                ";######|                                  |######;                                                                               ",
                ";######|                                  :%%%%%|!;;;;;:.                                                                        ",
                ";######|                                         |#####@:                                                                        ",
                ";######|                                         |#####@:                                                                        ",
                ";######|                                         |#####@:                                                                        ",
                ";######|                                               .%#####@:                                                                 ",
                ";######|                                               .%#####@:                                                                 ",
                ";######|                                               .%#####@:                                                                 ",
                ";######|                                                :!!!!!!!!!!!!;.                                                          ",
                ";######|                                                      .%#####&:                                                          ",
                ";######|                                                      .%#####&:                                                          ",
                ";######|                                                      .%#####&:                                                          ",
                ";######|                                                             .%#####&                                                    ",
                ";######|                                                             o%#####&                                                    ",
                ";######|                                                             o%#####&                                                   ",
                ";######|                                                              ;;;;;;||||||;.                                            ",
                ";######|                                                                    o$#####$                                            ",
                ";######|                                                                    o$#####$                                            ",
                ";######|                                                                    o$#####$                                            ",
                ";######|                                               .%#################################$                                     ",
                ";######|                                               .%#################################$o                                     ",
                ";######|                                               .%#################################$                                     ",
                ";######|                    :$$$$$$:                   .|#####@!o                                      ",
                ";######|                    !######;                   .%#####@:                                                                 ",
                ";######|                    !######;                   .%#####@:                                                                 ",
                ";######|                    !######;                   .%#####@:                                                                 ",
                ";######|             !######!      |######;                   .%#####&:                                                          ",
                ";######|             !######!      |######;                   .%#####&:                                                          ",
                ";######|             !######!      |######;                   .%#####&:                                                          ",
                ";######|      :&@@@@&!o.o.o.       |######;                   .%#####&:                                                          ",
                ";######|      ;######!             |######;                   .%#####&:                                                          ",
                ";######|      ;######!             |######;                   .%#####&:                                                          ",
                ";######|      !######!             |######;                   .%#####&:                                                          ",
                ";#############|                           |######;                   o$#####&                                                   ",
                ";#############|                           |######;                   o$#####&                                                   ",
                ";#############|                           |######;                   o$#####&                                                   ",
                ";######%o.....                            |#####@;                   o%#####&                                                   ",
                ";######|                                  |######;                   o$#####&                                                   ",
                ";######|                                  |######;                   o$#####&                                                   ",
                ";######%.                                 |######;                   o%#####&                                                   ",
                "                                                .|#####@:                   o$#####&                                           ",
                "                                                .|#####@:                   o$#####&                                            ",
                "                                                .|#####@:                   o$#####&                                            ",
                "                                                .|#####@:                   o$#####$                                            ",
                "                                                .|#####@:                   o$#####&                                            ",
                "                                                .|#####@:                   o$#####&                                            ",
                "                                                .|@@@@@&;......             o%@@@@@$:.....                                       ",
                "                                                       .%#####@:                   o$#####$                                     ",
                "                                                       .%#####@:                   o$#####$                                     ",
                "                                                       .%#####@:                   o$#####$                                     ",
                "                                                       .%#####@:                   o$#####$                                     ",
                "                                                       .%#####@:                   o$#####$                                     ",
                "                                                       .%#####@:                   o$#####$                                     ",
                "                                                       .!&&&&&$;oooooo       .ooooo:%&&&&&|                                     ",
                "                                                              .%#####&:     o$#####&                                            ",
                "                                                              .%#####&:     o$#####&                                            ",
                "                                                              .%#####&:     o$#####&                                            ",
                "                                                                     o$#####&                                                   ",
                "                                                                     o$#####&                                                   ",
                "                                                                     o$#####&  ",
            ]
            , self.position, color_map);
        use crate::gui::DISPLAY_BUFFER;
        for pixel in image {
            DISPLAY_BUFFER.write().push(pixel);
        }
    }

    fn get_level(&mut self) -> &usize {
        &self.level
    }
}
